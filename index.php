<?php

require_once 'config.php';
require_once 'bot.php';
require_once('simplevk-master/autoload.php');

use DigitalStar\vk_api\VK_api as vk_api; // –û—Å–Ω–æ–≤–Ω–æ–π –∫–ª–∞—Å—Å
use DigitalStar\vk_api\VkApiException; // –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫

$vk = vk_api::create(VK_API_ACCESS_TOKEN, "5.103")->setConfirm(CALLBACK_API_CONFIRMATION_TOKEN);
$data = json_decode(file_get_contents('php://input'));
$vk->sendOK();
$message_text = $data->object->message->text;
$peer_id = $data->object->message->peer_id;
$user_id = $data->object->message->from_id;
$message = $data->object->message;
$token = 'vk1.a.pPPvEfyKztl8_MT24Knxa5ahEdYt2HH9P8W76BXdFvhYmtMFgNzkHUdijKv-QO4aNwervFv2s4hgoTKALMSUsteJFovd93g93fZqeI445Yaecc0l4G0UTxUmR2Z2GuzHvvmNeuNdNsG7QZYK-o5PO0cRUzUkMj31qukgYGdW3G9fCvxgPlKcrYC3BX-x0d_JuU4RP9xV2wvM5vejZ2PMig'; //–°–≤–æ–π —Ç–æ–∫–µ–Ω
//$group_id = '176743770';
$group_id = '214838056';
$rubric = '';
$botVersion = '1.1.2';
$changeLog = "üÜï –í–µ—Ä—Å–∏—è 1.0 (16.08.22)\n- –ó–∞–ø—É—Å–∫ –±–æ—Ç–∞.\n- –î–æ–±–∞–≤–ª–µ–Ω–∞ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –ø—Ä–æ—Å–º–∞—Ç—Ä–∏–≤–∞—Ç—å —Å–ª—É—á–∞–π–Ω—ã–π –ø–æ—Å—Ç. \n- –î–æ–±–∞–≤–ª–µ–Ω–∞ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –ø—Ä–æ—Å–º–∞—Ç—Ä–∏–≤–∞—Ç—å —Å–ª—É—á–∞–π–Ω—ã–π –ø–æ—Å—Ç –∏–∑ —Ä–∞–∑–Ω—ã—Ö —Ä—É–±—Ä–∏–∫ (–ò–≥—Ä—ã, –ü–µ—Ä—Å–æ–Ω–∞–∂–∏, –î—Ä—É–≥–∏–µ –∏—Å—Ç–æ—á–Ω–∏–∫–∏ –∏ –ü—Ä–µ–¥–ª–æ–∂–∫–∞)\n
üÜï –í–µ—Ä—Å–∏—è 1.0.1 (26.08.22)\n - –î–æ–±–∞–≤–ª–µ–Ω–∞ –ø–æ–¥—Ä—É–±—Ä–∏–∫–∞ DmC –≤ —Ä—É–±—Ä–∏–∫—É –ò–≥—Ä—ã\n
üÜï –í–µ—Ä—Å–∏—è 1.1.0 (02.05.23)\n - –î–æ–±–∞–≤–ª–µ–Ω–æ –ü–û–†–ù–û (–¥–æ—Å—Ç—É–ø–Ω–æ —Ç–æ–ª—å–∫–æ –ø–æ –ø–ª–∞—Ç–Ω–æ–π –ø–æ–¥–ø–∏—Å–∫–µ)\n
üÜï –í–µ—Ä—Å–∏—è 1.1.1 (03.05.23)\n - –î–æ–±–∞–≤–ª–µ–Ω—ã –≤–∏–¥–µ–æ –∫ –ø—Ä–µ–¥—ã–¥—É—â–µ–º—É –æ–±–Ω–æ–≤–ª–µ–Ω–∏—é\n- –£–≤–µ–ª–∏—á–µ–Ω–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∫–∞—Ä—Ç–∏–Ω–æ–∫\n
üÜï –í–µ—Ä—Å–∏—è 1.1.2 (09.05.23)\n - –î–æ–±–∞–≤–ª–µ–Ω–æ –±–æ–ª—å—à–µ –≤–∏–¥–µ–æ\n- –£–≤–µ–ª–∏—á–µ–Ω–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∫–∞—Ä—Ç–∏–Ω–æ–∫\n- –î–æ–±–∞–≤–ª–µ–Ω —Å–ø–∏—Å–æ–∫ —Å–∫—Ä—ã—Ç—ã—Ö –∫–æ–º–∞–Ω–¥, –∫–æ—Ç–æ—Ä—ã–π –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è –ø–æ –∫–æ–º–∞–Ω–¥–µ –°–ø–∏—Å–æ–∫ —Å–∫—Ä—ã—Ç—ã—Ö –∫–æ–º–∞–Ω–¥";
$hiddenCommandsList = "–°–ø–∏—Å–æ–∫ –∫–æ–º–∞–Ω–¥:\n
üìç –ü–æ—Ä–Ω–æ –≤–∏–¥–µ–æ - –≤—ã–∑—ã–≤–∞–µ—Ç –ø–æ—Ä–Ω–æ –≤–∏–¥–µ–æ (–ø—Ä–∏ –Ω–∞–ª–∏—á–∏–∏ –ø–ª–∞—Ç–Ω–æ–π –ø–æ–¥–ø–∏—Å–∫–∏);\nüìç –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–æ—Ä–Ω–æ –≤–∏–¥–µ–æ - –≤—ã–≤–æ–¥–∏—Ç –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–æ—Ä–Ω–æ –≤–∏–¥–µ–æ –≤ –±–∞–∑–µ —Ñ—É–ª–ª–æ–≤;\nüìç –ü–æ—Ä–Ω–æ - –≤—ã–∑—ã–≤–∞–µ—Ç –ø–æ—Ä–Ω–æ –∫–∞—Ä—Ç–∏–Ω–∫—É (–ø—Ä–∏ –Ω–∞–ª–∏—á–∏–∏ –ø–ª–∞—Ç–Ω–æ–π –ø–æ–¥–ø–∏—Å–∫–∏);\nüìç –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–æ—Ä–Ω–æ - –≤—ã–≤–æ–¥–∏—Ç –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–æ—Ä–Ω–æ –∫–∞—Ä—Ç–∏–Ω–æ–∫ –≤ –±–∞–∑–µ —Ñ—É–ª–ª–æ–≤;\nüìç –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –ª—é–¥–µ–π, –∫–æ—Ç–æ—Ä–æ–µ —Å—ä–µ–ª –∂–∏—Ä–Ω—ã–π –ª—é–¥–æ–µ–¥ - –≤—ã–∑—ã–≤–∞–µ—Ç –¥–Ω–µ–≤–Ω–æ–π —Ä–∞—Ü–∏–æ–Ω –ú–∞—à–∏ –ù–µ–≤—Å–∫–æ–π –≤ –ª—é–¥—è—Ö;\nüìç –ë–µ—Å–µ–¥–∞ id - –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä —Ç–µ–∫—É—â–µ–π –±–µ—Å–µ–¥—ã;\nüìç –°–∫—Ä—ã—Ç—å –∫–ª–∞–≤–∏–∞—Ç—É—Ä—É - —Å–∫—Ä—ã–≤–∞–µ—Ç —Ç–µ–∫—É—â—É—é –∫–ª–∞–≤–∏–∞—Ç—É—Ä—É –±–æ—Ç–∞";

if (mb_strtolower($message_text) == '–Ω–∞—á–∞—Ç—å')
    SendWelcome($peer_id, $user_id, $vk);
else if (mb_strtolower($message_text) == '—Å–ª—É—á–∞–π–Ω—ã–π –ø–æ—Å—Ç')
    SendRndPost($peer_id, $vk, $token, $group_id);
else if (mb_strtolower($message_text) == '—Ä—É–±—Ä–∏–∫–∏')
    SendRubricButtons($peer_id, $vk);
else if (mb_strtolower($message_text) == 'üéÆ –∏–≥—Ä—ã')
    SendGameButtons($peer_id, $vk);
    else if (mb_strtolower($message_text) == 'devil may cry') {
        $rubric = '#dmc';
        SendRndRubricPost($peer_id, $vk, $token, $group_id, $rubric);  
    }
    else if (mb_strtolower($message_text) == 'devil may cry 2') {
        $rubric = '#dmc2';
        SendRndRubricPost($peer_id, $vk, $token, $group_id, $rubric);  
    }
    else if (mb_strtolower($message_text) == 'devil may cry 3') {
        $rubric = '#dmc3';
        SendRndRubricPost($peer_id, $vk, $token, $group_id, $rubric);  
    }
    else if (mb_strtolower($message_text) == 'devil may cry 4') {
        $rubric = '#dmc4';
        SendRndRubricPost($peer_id, $vk, $token, $group_id, $rubric);  
    }
    else if (mb_strtolower($message_text) == 'devil may cry 5') {
        $rubric = '#dmc5';
        SendRndRubricPost($peer_id, $vk, $token, $group_id, $rubric);  
    }
    else if (mb_strtolower($message_text) == 'dmc') {
        $rubric = '#dmcreboot';
        SendRndRubricPost($peer_id, $vk, $token, $group_id, $rubric);  
    }
else if (mb_strtolower($message_text) == 'üç® –ø–µ—Ä—Å–æ–Ω–∞–∂–∏')
    SendCharactersButtons($peer_id, $vk);
    else if (mb_strtolower($message_text) == '–≤–µ—Ä–≥–∏–ª–∏–π') {
        $rubric = '#vergil';
        SendRndRubricPost($peer_id, $vk, $token, $group_id, $rubric);  
    }
    else if (mb_strtolower($message_text) == '–¥–∞–Ω—Ç–µ') {
        $rubric = '#dante';
        SendRndRubricPost($peer_id, $vk, $token, $group_id, $rubric);  
    }
    else if (mb_strtolower($message_text) == '–Ω–µ—Ä–æ') {
        $rubric = '#nero';
        SendRndRubricPost($peer_id, $vk, $token, $group_id, $rubric);  
    }
    else if (mb_strtolower($message_text) == '–≤–∏') {
        $rubric = '#vdmc';
        SendRndRubricPost($peer_id, $vk, $token, $group_id, $rubric);  
    }
    else if (mb_strtolower($message_text) == '–Ω–∏–∫–æ') {
        $rubric = '#nico';
        SendRndRubricPost($peer_id, $vk, $token, $group_id, $rubric);  
    }
     else if (mb_strtolower($message_text) == '—Ç—Ä–∏—à') {
        $rubric = '#trish';
        SendRndRubricPost($peer_id, $vk, $token, $group_id, $rubric);  
    }
    else if (mb_strtolower($message_text) == '–ª–µ–¥–∏') {
        $rubric = '#lady';
        SendRndRubricPost($peer_id, $vk, $token, $group_id, $rubric);  
    }
    else if (mb_strtolower($message_text) == '—Ñ—å—é—Ä–∏') {
        $rubric = '#fury';
        SendRndRubricPost($peer_id, $vk, $token, $group_id, $rubric);  
    }
    else if (mb_strtolower($message_text) == '–∫–∏—Ä–∏–µ') {
        $rubric = '#kyrie';
        SendRndRubricPost($peer_id, $vk, $token, $group_id, $rubric);  
    }
else if (mb_strtolower($message_text) == 'üîó –¥—Ä—É–≥–∏–µ —Ä–µ—Å—É—Ä—Å—ã')
    SendSourceButtons($peer_id, $vk);
     else if (mb_strtolower($message_text) == 'reddit') {
        $rubric = '#reddit';
        SendRndRubricPost($peer_id, $vk, $token, $group_id, $rubric);  
    }
    else if (mb_strtolower($message_text) == 'twitter') {
        $rubric = '#twitter';
        SendRndRubricPost($peer_id, $vk, $token, $group_id, $rubric);  
    }
    else if (mb_strtolower($message_text) == 'pinterest') {
        $rubric = '#pinterest';
        SendRndRubricPost($peer_id, $vk, $token, $group_id, $rubric);  
    }
else if (mb_strtolower($message_text) == '‚ù§Ô∏èÔ∏è —Ç–≤–æ—Ä—á–µ—Å—Ç–≤–æ –ø–æ–¥–ø–∏—Å—á–∏–∫–æ–≤'){
        $vk->sendMessage($peer_id, '–í—ã–±—Ä–∞–Ω–∞ —Ä—É–±—Ä–∏–∫–∞: –¢–≤–æ—Ä—á–µ—Å—Ç–≤–æ –ø–æ–¥–ø–∏—Å—á–∏–∫–æ–≤');
        $rubric = '#–ü–†–ï–î–õ–û–ñ–ö–ê';
        SendRndRubricPost($peer_id, $vk, $token, $group_id, $rubric);  
    }
else if (mb_strtolower($message_text) == 'üîô –Ω–∞–∑–∞–¥')
    SendMainButtons($peer_id, $vk);
else if (mb_strtolower($message_text) == '–≤–µ—Ä—Å–∏—è')
    $vk->sendMessage($peer_id, "–¢–µ–∫—É—â–∞—è –≤–µ—Ä—Å–∏—è –±–æ—Ç–∞: $botVersion. –ò—Å—Ç–æ—Ä–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π:\n$changeLog");
else if (mb_strtolower($message_text) == '–ø–æ—Ä–Ω–æ')//307155262 $user_id == 528117878
    SendPorn($peer_id, $vk); 
else if (mb_strtolower($message_text) == '–∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–æ—Ä–Ω–æ')
    SendPornCount($peer_id, $vk); 
else if (mb_strtolower($message_text) == '–ø–æ—Ä–Ω–æ –≤–∏–¥–µ–æ')
    SendPornVid($peer_id, $vk); 
else if (mb_strtolower($message_text) == '–∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–æ—Ä–Ω–æ –≤–∏–¥–µ–æ')
    SendPornVidCount($peer_id, $vk); 
else if (mb_strtolower($message_text) == '–±–µ—Å–µ–¥–∞ id')
    $vk->sendMessage($peer_id, $peer_id);
else if (mb_strtolower($message_text) == '–∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ª—é–¥–µ–π, –∫–æ—Ç–æ—Ä–æ–µ —Å—ä–µ–ª –∂–∏—Ä–Ω—ã–π –ª—é–¥–æ–µ–¥')
    $vk->sendMessage($peer_id, '–î–Ω–µ–≤–Ω–æ–π —Ä–∞—Ü–∏–æ–Ω –ú–∞—à–∏ –ù–µ–≤—Å–∫–æ–π: 9 —á–µ–ª–æ–≤–µ–∫');
else if (mb_strtolower($message_text) == '—Å–ø–∏—Å–æ–∫ —Å–∫—Ä—ã—Ç—ã—Ö –∫–æ–º–∞–Ω–¥')
    $vk->sendMessage($peer_id, $hiddenCommandsList);
else if (mb_strtolower($message_text) == '—Å–∫—Ä—ã—Ç—å –∫–ª–∞–≤–∏–∞—Ç—É—Ä—É')
    KeyboardHide($peer_id, $vk);
else if (mb_strtolower($message_text) == '–∂–∏—Ä–Ω—ã–π –ª—é–¥–æ–µ–¥' || mb_strtolower($message_text) == '–∂—ã—Ä–Ω—ã–π –ª—é–¥–æ–µ–¥' || mb_strtolower($message_text) == '–∂—ã—Ä–Ω—ã–π –ª—é–¥–æ–µ–¥.' || mb_strtolower($message_text) == '–∂–∏—Ä–Ω—ã–π –ª—é–¥–æ–µ–¥.') {
    $vk->request('messages.send', ['peer_id' => $peer_id, 'attachment' => 'photo511642568_457268415']);
    $vk->request('messages.send', ['peer_id' => $peer_id, 'attachment' => 'photo511642568_457268415']);
    $vk->request('messages.send', ['peer_id' => $peer_id, 'attachment' => 'photo511642568_457268415']);
}
else if ($message->attachments[0]->type == 'sticker') {
    try {
            $sticker = $message->attachments[0]->sticker;
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä —Å—Ç–∏–∫–µ—Ä–∞
            $stickerId = $sticker->sticker_id;
            if ($stickerId == 85029) {
                $vk->request('messages.send', ['peer_id' => $peer_id, 'sticker_id' => 85029]);
            }
            else if ($stickerId == 86167) {
                $vk->request('messages.send', ['peer_id' => $peer_id, 'attachment' => 'photo-220493822_457239068']);
            }
    }
    catch (Exception $e) 
    {
        $vk->sendMessage($peer_id, '–û—à–∏–±–∫–∞: '. $e->getMessage());
        exit;
    }
}

else if (mb_strtolower($message_text) == '–¥–º—Ü')
{
    try 
    {
        $vk->sendMessage($peer_id, '–ó–∞–≥—Ä—É–∑–∫–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è...');
        $uploadServer = $vk->request('photos.getMessagesUploadServer', [
        'peer_id' => $peer_id // ID –±–µ—Å–µ–¥—ã
        ]);
        if (!$uploadServer) {
            $vk->sendMessage($peer_id, '–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ URL —Å–µ—Ä–≤–µ—Ä–∞: ' . $vk->getLastError());
            exit;
        }
        $photo = __DIR__ . '/che.jpg'; //'images/dmc/0001_MzFEiL35_M.jpg'; // –ø—É—Ç—å –∫ —Ñ–æ—Ç–æ
        $vk->sendMessage($peer_id, $photo);
        $fileContent = file_get_contents($photo);
        if (!$fileContent) {
            $vk->sendMessage($peer_id, '–û—à–∏–±–∫–∞ –ø—Ä–∏ —á—Ç–µ–Ω–∏–∏ —Ñ–∞–π–ª–∞: ' . error_get_last()['message']);
            exit;
        }
        $uploadResponse = $vk->upload($uploadServer['upload_url'], [
        'photo' => $fileContent
        ]);
        $saveResponse = $vk->request('photos.saveMessagesPhoto', [
        'server' => $uploadResponse['server'],
        'photo' => $uploadResponse['photo'],
        'hash' => $uploadResponse['hash']
        ]);
        $ownerId = $saveResponse[0]['owner_id'];
        $photoId = $saveResponse[0]['id'];
        $vk->request('messages.send', [
        'peer_id' => $peer_id, // ID –±–µ—Å–µ–¥—ã
        'attachment' => "photo{$ownerId}_{$photoId}"
        ]);
    }   
    catch (Exception $e) 
    {
        $vk->sendMessage($peer_id, '–û—à–∏–±–∫–∞: '. $e->getMessage());
        exit;
    }
}
    
    /*$MuteUser_id = 307155262;
    MuteUser($peer_id, $MuteUser_id, $vk);
    function MuteUser($peer_id, $MuteUser_id, $vk) 
    {
        $vk->request('messages.delete', ['message_ids' => $MuteUser_id, 'delete_for_all' => 1, 'peer_id' => $peer_id]);
        $vk->sendMessage($peer_id, "–†–∞–±–æ—Ç–∞–µ—Ç");
    }*/
    
